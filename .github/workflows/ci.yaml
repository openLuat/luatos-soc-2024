name: EC7xx
run-name: GoGoGo ğŸš€
on: 
  push:
  workflow_call:

jobs:
  # LuatOSå›ºä»¶ç¼–è¯‘
  EC718P_LuatOS:
    runs-on: ubuntu-latest
    # needs: "EC7xx_basic"
    strategy:
      fail-fast: false
      matrix:
        csdk_project:
          - luatos
        csdk_chip:
          - ec718u
          - ec718p
          - ec716e
          - ec718um
          - ec718hm
    steps:
      - name: å…‹éš† LuatOS ä»£ç åº“
        run:  git clone --depth=1 https://github.com/openLuat/LuatOS.git
      - name: å…‹éš† ec7xx-csdk ä»£ç åº“
        run: | 
          git clone --depth=1 https://github.com/openLuat/luatos-soc-2024.git
          sudo chmod +x luatos-soc-2024/PLAT/tools/fcelf
      - name: ä¸‹è½½GCCå·¥å…·é“¾
        run: |
          mkdir /home/runner/toolchains
          wget -q -O /home/runner/toolchains/gcc-arm-none-eabi-10-2020-q4-major-x86_64-linux.tar.bz2 https://github.com/wendal/xmake-docker/releases/download/dev-gcc/gcc-arm-none-eabi-10-2020-q4-major-x86_64-linux.tar.bz2
      - name: åˆå§‹åŒ–å·¥å…·é“¾
        run: |
          sudo add-apt-repository ppa:xmake-io/xmake -y
          sudo apt update -y
          sudo apt-get update -y && sudo apt-get install -y gcc make g++ wget curl p7zip-full 
          sudo dpkg --add-architecture i386 && sudo apt update
          sudo apt-get install -y lib32z1 libc6:i386 libgcc1:i386 libstdc++5:i386 libstdc++6:i386
          sudo apt-get install -y xmake
          xmake update
          # curl -fsSL https://xmake.io/shget.text | bash -s v2.8.9
          xmake g --pkg_searchdirs=/home/runner/toolchains
      - name: æ„å»ºæŒ‡å®šé¡¹ç›®
        run: |
          cd luatos-soc-2024/project/${{matrix.csdk_project}} 
          xmake f --chip_target=${{matrix.csdk_chip}} -y
          xmake -y --root

  EC7xx:
    runs-on: ubuntu-latest
    # needs: "EC7xx_basic"
    strategy:
      fail-fast: false
      matrix:
        csdk_chip:
          - ec718u
          - ec718p
        #   - ec716s
          - ec716e
          - ec718pm
          - ec718um
          - ec718hm
    steps:
      - name: å…‹éš† LuatOS ä»£ç åº“
        run:  git clone --depth=1 https://github.com/openLuat/LuatOS.git
      - name: å…‹éš† ec7xx-csdk ä»£ç åº“
        run: | 
          git clone --depth=1 https://github.com/openLuat/luatos-soc-2024.git
          sudo chmod +x luatos-soc-2024/PLAT/tools/fcelf
      - name: ä¸‹è½½GCCå·¥å…·é“¾
        run: |
          mkdir /home/runner/toolchains
          wget -q -O /home/runner/toolchains/gcc-arm-none-eabi-10-2020-q4-major-x86_64-linux.tar.bz2 https://github.com/wendal/xmake-docker/releases/download/dev-gcc/gcc-arm-none-eabi-10-2020-q4-major-x86_64-linux.tar.bz2
      - name: åˆå§‹åŒ–å·¥å…·é“¾
        run: |
          sudo add-apt-repository ppa:xmake-io/xmake -y
          sudo apt update -y
          sudo apt-get update -y && sudo apt-get install -y gcc make g++ wget curl p7zip-full python3
          sudo dpkg --add-architecture i386 && sudo apt update
          sudo apt-get install -y lib32z1 libc6:i386 libgcc1:i386 libstdc++5:i386 libstdc++6:i386
          sudo apt-get install -y xmake
          xmake update
          # curl -fsSL https://xmake.io/shget.text | bash -s v2.8.9
          xmake g --pkg_searchdirs=/home/runner/toolchains
      - name: æ„å»ºæŒ‡å®šé¡¹ç›®
        run: |
          cd luatos-soc-2024/ci/
          python3 ci_build.py ${{matrix.csdk_chip}}
